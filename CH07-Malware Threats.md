{%hackmd @themes/notion %}

###### tags: `資訊安全`

# CH07-Malware Threats
| 事項         | 時間                             |
| ------------ | -------------------------------- |
| 上課日期     | 2022/05/22(日) 09:00 ~ 18:00     |
| 最後更新日期 | 2022/07/31(日) 01:35             |
| 編輯人       | @pocper1、@2CwPgtM-RUuet4CyKo4Xmw |

## 文章
### 目錄
[TOC]

### 概要
> 了解惡意病毒種類及防範方法
---

## Malware Concepts
> To understand the various types of malware and their impact on network and system resources, we will begin with a discussion of the basic concepts of malware. 
> This section describes malware and highlights the common techniques used by attackers to distribute malware on the web.

### Introduction to Malware
> Malware is malicious software that damages or disables computer systems and gives limited or full control of the systems to the malware creator for malicious activities such as theft or fraud. Malware includes viruses, worms, Trojans, rootkits, backdoors, botnets, ransomware, spyware, adware, scareware, crapware, roughware, crypters, keyloggers, etc. These may delete files, slow down computers, steal personal information, send spam, or commit fraud. 

Malware programmers develop and use malware to: 
- Attack browsers and track websites visited 
- Slow down systems and degrade system performance 
- Cause hardware failure, rendering computers inoperable

<!-- 1. Trojans
2. backdoors
3. rookits
4. ransomware -->
## APT 
> APT，advanced persistant threats
> An advanced persistent threat is defined as a type of network attack whereby an attacker gains unauthorized access to a target network and remains in the network without being detected for a long time. 
- 高度目標性
- 高度目的性
- 低調、緩慢
- 客製化攻擊 (潛伏很長時間)
### APT live cycle
1. preparation
2. initial intrusion
3. expansion
4. persistance
5. search and exfiltration
6. cleanup

## Trojan Concepts
- Trojan 木馬程式，表面上有個功能，背地裡偷資料

### Types of Trojans
> Trojan are classified into many categories depending on the exploit functionality targets. Some Trojans types are listed below: 
1. Remote Access Trojans(RATs)
2. Backdoor Trojans
3. Botnet Trojans 
4. Rootkit Trojans 
5. E-Banking Trojans 
6. Point-of-Sale Trojans 
7. Defacement Trojans 
8. Service Protocol Trojans 
9. Mobile Trojans 
10. IoT Trojans  
11. Security Software Disabler Trojans 
12. Destructive Trojans 
13. DDoS Attack Trojans 
14. Command Shell Trojans

### Creating a Trojan
- Dropper
    > Droppers are programs that are used to camouflage malware payloads that can impede the functioning of the target system. The dropper consists of one or more types malware features that can make it undetectable by antivirus software.
    
- Downloader
    > A downloader is a program that can download and install harmful programs such as malware. 
    
    > 去下載真的惡意程式
- Wrapper 
    > Wrappers bind the Trojan executable with.EXE applications that appear genuine, such as games or office applications. When the user runs the wrapped .EXE application, it first installs the Trojan in the background and then runs the wrapping application in the foreground.
    
    > 打包
    >  ex: 木馬程式 80k+小算盤 20k=程式 100k
- Crypter
    > A crypter is a software that encrypts the original binary code of the .exe file. 
    
    > 為了不被防毒軟體抓到的偽裝
    > ex. bitcrypter，[網址](https://www.crypter.com)
    
- Exploit kit
    > An exploit kit or crimeware toolkit is used to exploit security loopholes found in software applications such as Adobe Reader and Adobe Flash Player, by distributing malware such as spyware, viruses, Trojans, worms, bots, backdoors, buffer overflow scripts, or other payloads to the target system. 
    
    > 攻擊懶人包
    > ex. RIG Exploit Kit，[網址](https://www.mandiant.com/resources/deep-dive-into-rig-exploit-kit-delivering-grobios-trojan)
    :::spoiler 其他攻擊懶人包
    - Magnitude 
    - Angler 
    - Neutrino 
    - Terror 
    - Sundown
    ::: 
    
## Virus and Worm Concepts
### Introduction to Viruses
> Viruses are the scourge of modern computing. Computer viruses have the potential to wreak havoc on both business and personal computers.

> 感染的是程式非電腦

### Working of Viruses
1. Infection Phase
2. Attack Phase

### type of virus 
:::danger
考試會考
考法: 一個敘述，問是甚麼病毒
:::

:::spoiler 23 types of virus
1. System or Boot Sector Virus 
2. File Virus
3. Multipartite Virus 
4. Macro Virus 
5. Cluster Virus 
6. Stealth/Tunneling Virus 
7. Encryption Virus 
8. Sparse Infector Virus 
9. Polymorphic Virus 
10. Metamorphic Virus 
11. Overwriting File or Cavity Virus 
12. Companion Virus/Camouflage Virus 
13. Shell Virus 
14. File Extension Virus 
15. FAT Virus 
16. Logic Bomb Virus 
17. Web Scripting Virus 
18. Email Virus 
19. Armored Virus 
20. Add-on Virus 
21. Intrusive Virus 
22. Direct Action or Transient Virus 
23. Terminate and Stay Resident Virus (TSR) 
:::

:::warning
### 常考的病毒種類
- 6. stealth/tunneling virus
    > 這種病毒會偷偷潛伏在記憶體之中，並保留感染前的檔案，當有任何風吹草動，例如防毒軟體出巡～等等，視察行為時，病毒會立刻擷取動作，並將事前保留的本體交出去檢查，以躲過任何掃描！
- 9. Polymorphic Virus
    > 電腦病毒會變種，千面人病毒
    >  千面人病毒可怕的地方，在於每當它們繁殖一次，就會以不同的病毒碼傳染到別的地方去。每一個中毒的檔案中，所含的病毒碼都不一樣，對於掃描固定病毒碼的防毒軟體來說，無疑是一個嚴重的考驗！如Whale病毒依附於.COM檔時，幾乎無法找到相同的病毒碼，而Flip病毒則只有2 byte的共同病毒碼（好像戴面具只剩兩個眼睛露出來）。
- 10. Metamorphic Virus
    > 電腦病毒會變態，變形惡意軟體
    > 是能夠在每次疊代中更改代碼和簽名形式的惡意軟體。
:::

## ransomware 
### Definition of ransomware
> Ransomware is a type of malware that restricts access to the infected computer system or critical files and documents stored on it, and then demands an online ransom payment to the malware creator(s) to remove user restrictions.

> 綁架病毒

:::spoiler examples
- Dharma
- eCh0raix(NAS)
- SamSam
- WannaCry 
- Petya 
- NotPetya 
- GandCrab 
- MegaCortex 
- LockerGoga 
- NamPoHyu 
- Ryuk 
- Cryptgh0st
:::

:::spoiler create virus tools
- Writing a Simple Virus Program 
- DELmE’s Batch Virus Maker
- JPS Virus Maker 
- Bhavesh Virus Maker SKW 
- Deadly Virus Maker 
- SonicBat Batch Virus Maker 
- TeraBIT Virus Maker 
- Andreinick05's Batch Virus Maker
:::

### Computer Worms
> Computer worms are standalone malicious programs that replicate, execute, and spread across network connections independently without human intervention.

> 獨立的exe
> ex. morris warm
#### difference between virus and worms
|                   | 電腦病毒                                    | 特洛伊木馬程式 | 電腦蠕蟲                                       |
| ----------------- | ------------------------------------------- | -------------- | ---------------------------------------------- |
| 感染其他檔案      | O                                           | X              | X                                              |
| 被動散播自己      | O                                           | O              | X                                              |
| 主動散播自己      | X                                           | X              | O                                              |
| 造成程式 增加數目 | 一般隨電腦使用率 提高，受染感檔案數目則增加 | 不增加         | 視網路連結狀況而定，連結範圍愈廣，散佈的數目多 |
| 破壞能力          | 視寫作者而定                                | 視寫作者而定   | X                                              |
| 對企業的影響性    | 中                                          | 低             | 高                                             |

:::spoiler worm makers
- Internet Worm Maker Thing 
- Batch Worm Generator 
- C++ Worm Generator
:::

## FIleless Malware Concepts
### Fileless Malware
> 無檔案病毒攻擊，常駐在記憶體當中
1. Stealth
    >  Fileless malware exploits legitimate system tools; hence, it is extremely difficult to detect, block, or prevent fileless attacks.

2. LOL(Living-off-the-land)
    > System tools exploited by fileless malware are already installed in the system by default. An attacker does not need to create and install custom tools on the target system.
    - lol attack ithome [就地取材攻擊 leaving-of-the-land(LotL)](https://www.ithome.com.tw/news/150233)
3. Trustworthy
    > The system tools used by fileless malware are the most frequently used and trusted tools; hence, security tools incorrectly assume that such tools are running for a legitimate purpose.

### Taxonomy of Fileless Malware Threat
- type 1:Hardware
    - No file activity performed
- type 2: Execution/Injection
    - No files written on disk, but some files used indirectly
- type 3: Explit
    - File required to achive fileless persistence(透過系統漏洞)

<img src="https://docs.microsoft.com/en-us/microsoft-365/media/security-intelligence-images/fileless-malware.png?view=o365-worldwide" />

> ex: emotet 透過word檔做散播
    - word -> vba -> powershell -> download virus
> 混淆病毒: " , ^ 環境變數

## Malware Analysis
> Malware 
> is a program designed to perform malicious activities (the term itself is a contraction of “malicious software”). Malware such as viruses, Trojans, worms, spyware, and rootkits allow an attacker to breach security defenses and subsequently launch attacks on target systems. 

> 惡意程式分析

### Sheep Dip Computer
> Sheep dipping 
> is a process used in sheep farming, whereby sheep are dipped in chemical solutions to make them parasite-free. 

> 樣本分析

### Types of Malware Analysis 
1. Static Malware Analysis
2. Dynamic Malware Analysis


#### 1. Static Malware Analysis
> Static analysis is the process of investigating an executable file without running or installing it.
> 靜態分析

- 看特徵
    - 工具：pestudio
    > 透過檔案雜湊去搜尋 virus total
    
    ![PE studio](https://betanews.com/wp-content/uploads/2015/01/PEStudio.jpg)
    
- Identifying Packing/Obfuscation Methods
    - 工具: PEid，[PEid](https://www.aldeid.com)
    > PEiD is a free tool that provides details about Windows executable files. It can identify signatures associated with over 600 different packers and compilers. This tool also displays the type of packers used for packing the program. It also displays additional details such as entry point, file offset, EP section, and subsystem used for packing.
    - exe -> exe 壓縮殼
    - 加密殼 保護自己別被逆向分析
    
- Malware Disassembly
    - 工具：IDA，[IDA](https://www.hex-rays.com)


#### 2. Dynamic Malware Analysis
> Dynamic malware analysis is the process of studying the behavior of malware by running it in a monitored environment.
> 實際執行

- 工具：Process Monitor
    ![Process Monitor](https://docs.microsoft.com/zh-tw/sysinternals/downloads/media/procmon/procmon-main.png)

- 工具：autoruns for windows
    ![autoruns for windows](https://docs.microsoft.com/zh-tw/sysinternals/downloads/media/autoruns/autoruns_v13.png)

- log analysis
    - 工具：splunk，[splunk](https://www.splunk.com)
    ![splunk](https://www.splunk.com/content/dam/splunk2/images/screenshots/platform-journey/conflaunch/SS-UI-Light-Mode-frame.png)
:::info
### Process 的四大行為
- 執行續 
- 網路 
- 檔案 
- 吞吐
:::


## CH07 Practice
1. [Lab 1.1] Gain Control over a Victim Machine using the njRAT RAT Trojan






